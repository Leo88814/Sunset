<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>編輯電影</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link href="css/Back-office.css" rel="stylesheet" />
    <script src="https://unpkg.com/vue@3"></script>
  </head>
  <body>
    <div id="app">
      <sidebar-component></sidebar-component>
      <header-component></header-component>
      <div class="content">
        <h2>編輯電影</h2>
        <form @submit.prevent="updateMovie">
          <div class="mb-3">
            <label for="movieName" class="form-label">電影名稱</label>
            <input
              type="text"
              class="form-control"
              id="movieName"
              v-model="movie.name"
              required
            />
          </div>
          <div class="mb-3">
            <label for="englishName" class="form-label">英文名稱</label>
            <input
              type="text"
              class="form-control"
              id="englishName"
              v-model="movie.englishName"
              required
            />
          </div>
          <div class="mb-3">
            <label for="rating" class="form-label">分級</label>
            <select
              class="form-select"
              id="rating"
              v-model="movie.rating"
              required
            >
              <option value="普遍級">普遍級</option>
              <option value="保護級">保護級</option>
              <option value="輔導級">輔導級</option>
              <option value="限制級">限制級</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="duration" class="form-label">片長 (分鐘)</label>
            <input
              type="number"
              class="form-control"
              id="duration"
              v-model="movie.duration"
              required
            />
          </div>
          <div class="mb-3">
            <label for="director" class="form-label">導演</label>
            <input
              type="text"
              class="form-control"
              id="director"
              v-model="movie.director"
              required
            />
          </div>
          <div class="mb-3">
            <label for="genre" class="form-label">類型</label>
            <select
              class="form-select"
              id="genre"
              v-model="movie.genre"
              required
            >
              <option value="動作">動作</option>
              <option value="喜劇">喜劇</option>
              <option value="劇情">劇情</option>
              <option value="恐怖">恐怖</option>
              <option value="科幻">科幻</option>
              <option value="愛情">愛情</option>
            </select>
          </div>
          <div class="mb-3">
            <label for="language" class="form-label">語言</label>
            <input
              type="text"
              class="form-control"
              id="language"
              v-model="movie.language"
              required
            />
          </div>
          <div class="mb-3">
            <label for="actors" class="form-label">演員</label>
            <input
              type="text"
              class="form-control"
              id="actors"
              v-model="movie.actors"
              required
            />
          </div>
          <div class="mb-3">
            <label for="distributor" class="form-label">發行</label>
            <input
              type="text"
              class="form-control"
              id="distributor"
              v-model="movie.distributor"
              required
            />
          </div>
          <div class="mb-3">
            <label for="releaseDate" class="form-label">首映日期</label>
            <input
              type="date"
              class="form-control"
              id="releaseDate"
              v-model="movie.releaseDate"
              required
            />
          </div>
          <div class="mb-3">
            <label for="photo" class="form-label">照片</label>
            <input
              type="file"
              class="form-control"
              id="photo"
              @change="previewImage"
              required
            />
            <img
              :src="movie.photo"
              alt="電影照片"
              class="img-thumbnail mt-2"
              v-if="movie.photo"
            />
          </div>
          <div class="mb-3">
            <label for="trailer" class="form-label">預告連結</label>
            <input
              type="url"
              class="form-control"
              id="trailer"
              v-model="movie.trailer"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary">更新電影</button>
        </form>
      </div>
    </div>

    <script src="js/common.js"></script>
    <script>
      const { ref, onMounted } = Vue;

      const app = Vue.createApp({
        components: {
          "sidebar-component": common,
          "header-component": header,
        },
        setup() {
          const movie = ref({
            id: "",
            name: "",
            englishName: "",
            rating: "",
            duration: "",
            director: "",
            genre: "",
            language: "",
            actors: "",
            distributor: "",
            releaseDate: "",
            photo: "",
            trailer: "",
          });

          onMounted(() => {
            // 從 URL 獲取電影 ID
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get("id");

            // 這裡應該根據 movieId 從後端獲取電影數據
            // 為了演示，我們使用模擬數據
            movie.value = {
              id: movieId,
              name: "示例電影",
              englishName: "Example Movie",
              rating: "普遍級",
              duration: 120,
              director: "示例導演",
              genre: "動作",
              language: "中文",
              actors: "示例演員",
              distributor: "示例發行",
              releaseDate: "2024-01-01",
              photo: "",
              trailer: "https://example.com/trailer",
            };
          });

          const previewImage = (event) => {
            const file = event.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = (e) => {
                movie.value.photo = e.target.result;
              };
              reader.readAsDataURL(file);
            }
          };

          const updateMovie = () => {
            // 這裡添加更新電影的邏輯
            console.log("更新電影:", movie.value);
            // 更新成功後可以跳轉回電影列表頁面
            // window.location.href = 'adminMovies.html';
          };

          return {
            movie,
            updateMovie,
            previewImage,
          };
        },
      });

      app.mount("#app");
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
