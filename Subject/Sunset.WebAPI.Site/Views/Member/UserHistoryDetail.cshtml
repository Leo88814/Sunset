@{
    ViewBag.Title = "歷史訂單";
}

<style>
    .ticket {
        border: 1px solid #000;
        padding: 15px;
        margin-bottom: 20px;
        background-color: #e7d7bc;
        border-radius: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .ticket img {
            width: 100px;
            cursor: pointer;
            border-radius: 10px;
        }

    .ticket-details {
        flex: 1;
        margin-left: 20px;
    }

        .ticket-details p {
            margin: 5px 0;
        }
</style>

<body>
    <div id="app" class="page-container">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="Main.html">首頁</a></li>
                    <li class="breadcrumb">會員專區</li>
                    <li class="breadcrumb active">歷史訂單</li>
                </ol>
            </nav>
        </div>
        <div>
            <h1>歷史訂單</h1>
            <div v-if="userHistory.length">
                <div v-for="history in userHistory" :key="history.OrderNumber + history.Seat" class="ticket">
                    <img v-if="history.Movie && history.Movie.MainPicture" :src="history.Movie.MainPicture" alt="Movie Picture" />
                    <div class="ticket-details">
                        <p>電影名稱：{{ history.Movie.MovieName }}</p>
                        <p>訂單編號：{{ history.OrderNumber }}</p>
                        <p>日期：{{ history.Date }} </p>
                        <p>場次：{{ history.Time }}</p>
                        <p>座位：{{ history.Seat }}</p>
                        <p>票數：{{ history.Quantity }} 張</p>
                    </div>
                </div>
            </div>
            <div v-else>
                <p>No history available.</p>
            </div>
        </div>
    </div>

    @section scripts {
        <script>
            const { createApp } = Vue;

            createApp({
                data() {
                    return {
                        userHistory: []
                    };
                },
                created() {
                    this.fetchUserHistory();
                },
                methods: {
                    async fetchUserHistory() {
                        try {
                            const response = await fetch('/api/MemberApiController/UserHistory?memberId=1');
                            if (!response.ok) {
                                throw new Error(`HTTP error! status: ${response.status}`);
                            }
                            this.userHistory = await response.json();
                        } catch (error) {
                            console.error('Error fetching user history:', error);
                        }
                    }
                }
            }).mount('#app');
        </script>
    }
</body>