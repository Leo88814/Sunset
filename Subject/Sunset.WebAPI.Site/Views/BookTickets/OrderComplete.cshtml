
@{
    ViewBag.Title = "線上訂票-訂單完成";
}

<head>
    <title>線上訂票-訂單完成</title>
</head>
<body>
    <div id="app" class="page-container">
        <section class="order-completion mt-5 container">
            <nav style="--bs-breadcrumb-divider: '>'" aria-label="breadcrumb">
                <ol class="breadcrumb ms-3">
                    <li class="breadcrumb-item"><a href="@Url.Action("index", "Home")">首頁</a></li>
                    <li class="breadcrumb">線上訂票</li>
                    <li class="breadcrumb">訂單完成</li>
                </ol>
            </nav>
            <h2 class="text-center">感謝您使用訂票平台</h2>

            <!-- 訂單資訊表格 -->
            <table class="table table-bordered mt-3">
                <tbody>
                    <tr>
                        <th>訂單時間</th>
                        <td>{{orderInfo}}</td>
                    </tr>
                    <tr>
                        <th>訂單編號</th>
                        <td>{{ordernumber}}</td>
                    </tr>
                    <tr>
                        <th>電影票號</th>
                        <td>
                            <ul>
                                <!-- 顯示多個電影票號 -->
                                <li v-for="(ticket, index) in ticketnumbers" :key="index">
                                    {{ ticket }}
                                </li>
                            </ul>
                        </td>
                    </tr>
                    <tr>
                        <th>電影名稱</th>
                        <td>{{ selectedMovie?.name }}</td>
                    </tr>
                    <tr>
                        <th>日期場次</th>
                        <td>{{ selectedDate?.date }} {{ selectedTime?.time }}</td>
                    </tr>
                    <tr>
                        <th>影廳</th>
                        <td></td>
                    </tr>
                    <tr>
                        <th>票種</th>
                        <td>
                            <span v-for="(ticket, index) in selectedTickets" :key="index">
                                {{ ticket.name }}:{{ ticket.quantity }}張
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <th>座位</th>
                        <td>
                            <span> {{ formattedSeats }} </span>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="text-end mt-3">
                <button v-on:click="goBack" class="btn btn-danger">
                    回到首頁
                </button>
                <button v-on:click="goToNextPage" class="btn btn-primary ms-2">
                    前往票夾
                </button>
            </div>
        </section>
    </div>

    @section scripts{
        <script>
            const { createApp, ref, onMounted, computed } = Vue;

            const config = {

                setup() {
                    const selectedMovie = ref(null);
                    const selectedDate = ref(null);
                    const selectedTime = ref(null);
                    const ordernumber = ref("0120240831001");
                    const ticketnumbers = ref([]);
                    const selectedTickets = ref([]);
                    const selectedSeats = ref([]);

                    // 計算總票數
                    const totalTickets = computed(() => {
                        return selectedTickets.value.reduce(
                            (sum, ticket) => sum + ticket.quantity,
                            0
                        );
                    });


                    // 當頁面掛載時，從 localStorage 讀取資料
                    onMounted(() => {
                   
                        const savedTickets = JSON.parse(
                            localStorage.getItem("selectedTickets")
                        );
                    
                        if (savedTickets) selectedTickets.value = savedTickets;
                    });

                    const orderInfo = ref(
                        new Date().toLocaleString("zh-TW", {
                            year: "numeric",
                            month: "2-digit",
                            day: "2-digit",
                            hour: "2-digit",
                            minute: "2-digit",
                            second: "2-digit",
                            hour12: false,
                        })
                    );


                    const formattedSeats = computed(() => {
                        return selectedSeats.value.join(", ");
                    });

                    const goBack = () => {
                        window.location.href = "@Url.Action("index", "Home")"; // 回首頁
                    };

                    const goToNextPage = () => {
                        window.location.href = "User-Ticket.html"; // 跳轉到票夾
                    };

                    return {
                        orderInfo,
                        goBack,
                        goToNextPage,
                    
                        selectedTickets,
                        formattedSeats,
                     
                      
                    };
                },
            };

            const app = createApp(config);
            app.mount("#app");
        </script>
    }
</body>


