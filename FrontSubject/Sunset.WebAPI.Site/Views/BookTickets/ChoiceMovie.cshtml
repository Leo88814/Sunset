
@{
    ViewBag.Title = "ChoiceMovie";
}
<style>
    .login-section{
        overflow:auto;
        scrollbar-color:#fff #fff;
    }
</style>
<html lang="zh-TW">
<head>
    <link rel="stylesheet" href="~/CSS/styles.css" />
</head>
<body>
    <div id="app" class="page-container">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="Main.html">首頁</a></li>
                    <li class="breadcrumb">線上訂票</li>
                    <li class="breadcrumb">選擇電影</li>
                </ol>
            </nav>
        </div>

        <div class="login-section container">
            <h2 class="text">線上訂票步驟</h2>
            <div class="step-bar">
                <div class="step-item fw-bolder">1.選擇電影</div>
                <div class="step-item">2.場次選擇</div>
                <div class="step-item">3.確認訂單</div>
                <div class="step-item">4.訂單完成</div>
            </div>

            <div class="container">
                <div class="col d-flex flex-wrap"
                     style="justify-content: space-around">
                    <div class="card border-0 text-center"
                         v-for="c in cards"
                         :key="c.id">
                        <img :src="c.MainPicture" />
                        <p class="text-center fw-bolder mt-1">{{ c.MovieName }}</p>
                        <div class="text-center">
                            <a v-on:click="bookMovie(c)" class="btn btn-primary mt-2">立即購票</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3.5.4/dist/vue.global.js"></script>
    <script src="~/js/header-component.js"></script>
    <script src="~/js/footer-component.js"></script>
    <script>
        const { createApp, ref, onMounted } = Vue;

        // 定義 HeaderComponent
        const config = {
            components: {
                "header-component": HeaderComponent,
                "footer-component": FooterComponent,
            },
            setup() {
                const url = "/api/ChoiceMoviesApi/";
                const cards = ref([]);

                const bookMovie = (card) => {
                    // 將電影資訊儲存到 localStorage 中
                    localStorage.setItem("selectedMovie", JSON.stringify(card));
                    
                    // 跳轉到下一頁
                    window.location.href = "ChoiceDate";
                };

                onMounted(async () => {
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            cards.value = data;
                        })
                        .catch(error => {
                            console.error("Error", error);
                        });
                });

                return { cards, bookMovie };
            },
        };

        const app = createApp(config);
        app.mount("#app");
    </script>
</body>
</html>
